@model HomeViewModel
@inject IViewLocalizer Localizer
@{
    ViewData["Title"] = Localizer["HomePage"];
}

<div class="container">
    <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#collections" role="tab" aria-controls="collections" aria-selected="true">@Localizer["Collections"]</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="profile-tab" data-toggle="tab" href="#items" role="tab" aria-controls="items" aria-selected="false">@Localizer["Items"]</a>
        </li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane fade show active" id="collections" role="tabpanel" aria-labelledby="home-tab">
            @if (Model.Collections.Count == 0)
            {
                <div class="alert alert-info text-center my-3">@Localizer["NoCollectionMessage"]</div>
            }
            else
            {
                <div class="card-columns py-3">
                    @foreach (var collection in Model.Collections)
                    {
                        <div class="card bg-light shadow-sm">
                            @if (!string.IsNullOrEmpty(collection.ImagePath))
                            {
                                <a asp-controller="Profile" asp-action="Collection" asp-route-collectionId="@collection.Id" asp-route-returnUrl="@UriHelper.GetDisplayUrl(Context.Request)">
                                    <img class="bd-placeholder-img card-img-top" src="@collection.ImagePath" focusable="false" role="img">
                                </a>
                            }
                            <div class="card-body">
                                <h5 class="card-title">
                                    <a class="card-link text-dark" asp-controller="Profile" asp-action="Collection"
                                       asp-route-collectionId="@collection.Id" asp-route-returnUrl="@UriHelper.GetDisplayUrl(Context.Request)">@collection.Name (@collection.Theme.Name)</a>
                                </h5>
                                @if (collection.Description != null)
                                {
                                    <hr />
                                    <div class="js-markdown-element">@collection.Description</div>
                                }
                            </div>
                        </div>
                    }
                </div>
            }
        </div>
        <div class="tab-pane fade pt-3" id="items" role="tabpanel" aria-labelledby="profile-tab">
            @if (Model.Items.Count == 0)
            {
                <div class="alert alert-info text-center my-3">@Localizer["NoItemMessage"]</div>
            }
            else
            {
                <div class="accordion" id="accordionItems">
                    @foreach (var item in Model.Items)
                    {
                        <div class="card bg-light">
                            <div id="@($"heading{item.Id}")" class="card-header">
                                <h2 class="mb-0">
                                    <button class="btn btn-block text-left" type="button" data-toggle="collapse"
                                            data-target="#@($"collapse{item.Id}")" aria-expanded="false" aria-controls="@($"collapse{item.Id}")">
                                        @item.Name
                                    </button>
                                </h2>
                            </div>
                            <div id="@($"collapse{item.Id}")" class="collapse" aria-labelledby="@($"heading{item.Id}")" data-parent="#accordionItems">
                                <div class="card-body">

                                    <div>
                                        <div class="card-text m-1">Owner: <a class="card-link text-dark" asp-controller="Profile" asp-action="Index" asp-route-userName="@item.Collection.User.UserName">@item.Collection.User.UserName</a></div>
                                        <div class="card-text m-1">Collection: <a class="card-link text-dark" asp-controller="Profile" asp-action="Collection" asp-route-collectionId="@item.CollectionId" asp-route-returnUrl="@UriHelper.GetDisplayUrl(Context.Request)">@item.Collection.Name</a></div>
                                        @if (item.FieldValues.Count != 0)
                                        {
                                            <hr />
                                        }
                                        @foreach (var fieldValue in item.FieldValues)
                                        {
                                            if (fieldValue.Field.Type.Name == "Check box")
                                            {
                                                <div class="card-text m-1">@fieldValue.Field.Name: @(fieldValue.Value == "checked" ? Localizer["Yes"] : Localizer["No"])</div>
                                            }
                                            else if (fieldValue.Field.Type.Name == "Markdown")
                                            {
                                                <div class="m-1">
                                                    <div class="card-text">@fieldValue.Field.Name</div>
                                                    <div class="js-markdown-element js-markdown-element-border">@fieldValue.Value</div>
                                                </div>
                                            }
                                            else
                                            {
                                                <div class="card-text m-1">@fieldValue.Field.Name: @(string.IsNullOrEmpty(fieldValue.Value) ? "-" : fieldValue.Value)</div>
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="~/js/markdown.js" asp-append-version="true"></script>